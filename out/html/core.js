window.game={compiled:'{"scenes":{"prevScene":{"id":"prevScene","content":{"content":"","type":"paragraph"}},"prevTopScene":{"id":"prevTopScene","content":{"content":"","type":"paragraph"}},"jumpScene":{"id":"jumpScene","content":{"content":"","type":"paragraph"}},"backSpecialScene":{"id":"backSpecialScene","content":{"content":"","type":"paragraph"}},"returnScene":{"id":"returnScene","content":{"content":"","type":"paragraph"}},"cards.card1":{"id":"cards.card1","title":"Card 1 - challenges","isCard":true,"newPage":true,"tags":["deck1"],"options":[{"id":"@cards.c1_challenge1"},{"id":"@cards.c1_back"}],"content":{"content":"(text for Card 1 goes here)","type":"paragraph"}},"main.deck":{"id":"main.deck","title":"Deck 1","subtitle":"Deck 1 subtitle","isDeck":true,"options":[{"id":"#deck1"}],"content":{"content":"","type":"paragraph"}},"main":{"id":"main","type":"scene","title":"Main","newPage":true,"isHand":true,"maxCards":3,"options":[{"id":"@main.deck"},{"id":"#pinnedCard"}],"content":{"content":"Here, the main deck will be displayed. Clicking on the deck draws a card into your hand. Clicking on a card activates that card.","type":"paragraph"}},"status":{"id":"status","type":"scene","title":"Status","newPage":true,"isSpecial":true,"content":{"content":[{"type":"heading","content":"Status"},{"type":"paragraph","content":"This is displayed in the sidebar, and can be used to show various things."},{"type":"paragraph","content":["Magic ",{"type":"insert","insert":0},""]}],"stateDependencies":[{"type":"insert","fn":{"$code":"return (Q[\'magic\'] || 0);"},"qdisplay":"qmagic"}]}},"pinned_cards.pc1":{"id":"pinned_cards.pc1","title":"Pinned Card 1","subtitle":"Description of Pinned Card 1","isPinnedCard":true,"newPage":true,"tags":["pinnedCard"],"content":{"content":"(Pinned Card 1 - something happens here)","type":"paragraph"}},"root.start_menu":{"id":"root.start_menu","options":[{"id":"@root.start","title":"Start game"},{"id":"@root.credits","title":"Credits"}],"content":{"type":"heading","content":"Train To Parabella"}},"cards.c1_challenge1":{"id":"cards.c1_challenge1","title":"Challenge 1 - magic","checkQuality":"magic","broadDifficulty":5,"checkSuccessGoTo":"cards.c1_magic_win","checkFailureGoTo":"cards.c1_magic_lose","content":{"content":"","type":"paragraph"}},"pinned_cards.pc2":{"id":"pinned_cards.pc2","title":"Pinned Card 2","subtitle":"Description of Pinned Card 2","isPinnedCard":true,"newPage":true,"tags":["pinnedCard"],"content":{"content":"(Pinned Card 2 - something happens here)","type":"paragraph"}},"pinned_cards":{"id":"pinned_cards","type":"scene","title":"Pinned Cards","content":{"content":"","type":"paragraph"}},"root.start":{"id":"root.start","onArrival":[{"$code":"Q[\'started\'] = 1;"}],"newPage":true,"options":[{"id":"@main","title":"Main status"}],"content":{"content":"(text for introducing the game goes here, etc.)","type":"paragraph"}},"cards.c1_magic_win":{"id":"cards.c1_magic_win","content":{"content":"Congratulations, you won the challenge!","type":"paragraph"}},"root.credits":{"id":"root.credits","options":[{"id":"@root.start_menu","title":"Back to menu"}],"content":{"content":"(Credits go here)","type":"paragraph"}},"root":{"id":"root","type":"scene","title":"Root Scene","newPage":true,"goTo":[{"id":"main","predicate":{"$code":"return ((Q[\'started\'] || 0)===1);"}},{"id":"root.start_menu","predicate":{"$code":"return ((Q[\'started\'] || 0)===0);"}}],"content":{"content":"","type":"paragraph"}},"cards.c1_magic_lose":{"id":"cards.c1_magic_lose","onArrival":[{"$code":"Q[\'magic\'] = (Q[\'magic\'] || 0) + 1;"}],"content":{"content":"Oh no, you failed the challenge! But you learned some magic.","type":"paragraph"}},"cards.c1_back":{"id":"cards.c1_back","title":"Back","goTo":[{"id":"main"}],"content":{"content":"","type":"paragraph"}},"cards.card2":{"id":"cards.card2","title":"Card 2","isCard":true,"newPage":true,"tags":["deck1"],"maxVisits":1,"content":{"content":"(text for card 2 goes here)","type":"paragraph"},"countVisitsMax":1},"cards":{"id":"cards","type":"scene","title":"Cards","content":{"content":"","type":"paragraph"}}},"qualities":{"anxiety":{"id":"anxiety","type":"quality","name":"Anxiety","initial":0,"content":{"content":"","type":"paragraph"}},"hunger":{"id":"hunger","type":"quality","name":"Hunger","initial":0,"min":0,"max":20,"content":{"content":"An indication of how hungry you are.","type":"paragraph"}},"magic":{"id":"magic","type":"quality","name":"Magic","initial":0,"content":{"content":"","type":"paragraph"}}},"qdisplays":{"qmagic":{"id":"qmagic","type":"qdisplay","content":[{"min":0,"max":1,"output":": none"},{"min":2,"max":4,"output":": weak"},{"min":5,"output":": decent"}]},"qhunger":{"id":"qhunger","type":"qdisplay","content":[{"min":0,"max":2,"output":": Not hungry"},{"min":3,"max":10,"output":": A little hungry"}]}},"tagLookup":{"deck1":{"cards.card1":true,"cards.card2":true},"pinnedCard":{"pinned_cards.pc1":true,"pinned_cards.pc2":true}}}'},function t(e,i,n){function a(o,s){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[o]={exports:{}};e[o][0].call(u.exports,(function(t){var i=e[o][1][t];return a(i||t)}),u,u.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(t,e,i){!function(){"use strict";var t=function(t){if(!t)throw new Error("Assertion failed.")},i=function(t,e){for(var i=0;i<t.length;++i)e(t[i])},n=function(t,e){for(var i in t)e(i,t[i])},a=function(){for(var t={},e=0;e<arguments.length;++e){var i=arguments[e];for(var n in i)t[n]=i[n]}return t},r=function(t){t=t.trim();var e=new Function("state","Q",t);return e.source=t,e},o=function(t,e,n){void 0!==t&&i(t,(function(t){try{t.call(e,n,n.qualities)}catch(t){console.log("Error:",t)}}))},s=function(t,e,i,n){var a=e;if(void 0===t)return a;try{a=!!t.call(i,n,n.qualities)}catch(t){console.log("Error:",t)}return a},c=function(t,e,i,n){var a=e;if(void 0===t)return a;try{a=t.call(i,n,n.qualities)}catch(e){console.log("Error in expression",t,":",e)}return a},d=function(t){return[{type:"paragraph",content:t}]},u=function(t){return Math.floor(t)===t&&t>=0&&t<=12?["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"][t]:t.toString()},l=function(t){if(!(Math.floor(t)===t&&t>=0))return t.toString();if(t<=12)return["zeroth","first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth"][t];if(t=t.toString(),/1[0-9]$/.test(t))return t+"th";switch(t.substr(t.length-1,1)){case"1":return t+"st";case"2":return t+"nd";case"3":return t+"rd";default:return t+"th"}},h=function(t){if(Math.floor(t)!==t)return t.toString();if(t>3)return"superb+"+(t-3);if(t<-3)return"terrible"+(t+3);switch(t){case 3:return"superb";case 2:return"great";case 1:return"good";case 0:return"fair";case-1:return"mediocre";case-2:return"poor";case-3:return"terrible"}},p=function(t,e){for(var i=0;i<e.content.length;++i){var n=e.content[i],a=n.min,r=n.max;if((void 0===a||a<=t)&&(void 0===r||r>=t))return void 0!==n.output?n.output:t.toString()}return t.toString()},g=function(t,e,i,n){i||(i=.6),i>1&&(i/=100);var a=i*(t/e);return a>1&&(a=1),a},f=function(t,e,i){i||(i=.1),i>1&&(i/=100);var n=(t-e)*i+.5;return n>1?n=1:n<i&&(n=i),n},m=function(t){return t<=.1?"almost impossible":t<=.3?"high-risk":t<=.4?"tough":t<=.5?"very chancy":t<=.6?"chancy":t<=.7?"modest":t<=.8?"very modest":t<=.9?"low risk":"straightforward"},v=function(){};v.prototype.beginGame=function(){},v.prototype.displayContent=function(t,e){},v.prototype.displayDecks=function(t){},v.prototype.displayHand=function(t){},v.prototype.displayPinnedCards=function(t){},v.prototype.displayChoices=function(t){},v.prototype.displayGameOver=function(){this.displayContent(d("Game Over"))},v.prototype.removeChoices=function(){},v.prototype.beginOutput=function(){},v.prototype.endOutput=function(){},v.prototype.newPage=function(){},v.prototype.setStyle=function(t){},v.prototype.signal=function(t){},v.prototype.setBg=function(t){},v.prototype.setSprites=function(t){},v.prototype.setSpriteStyle=function(t,e){},v.prototype.audio=function(t){},v.makeParentOf=function(t){t.prototype=new v,t.constructor=t};var y=function(t,e){this.ui=t,this.game=e};y.prototype.displayGameOver=function(){return this.ui.displayGameOver(),this},y.prototype.displayChoices=function(){var e=this.getCurrentChoices();t(e);var i=this.getCurrentScene();if(i.isHand){var n=[],a=[];for(var r of e){var o=this.game.scenes[r.id];o.isDeck?(this._drawFromDeck(r.id)?r.canChoose=!0:(r.canChoose=!1,r.subtitle=r.unavailableSubtitle||"No cards available from deck."),r.isDeck=!0,r.image=o.cardImage,n.push(r)):o.isPinnedCard&&(r.isDeck=!1,r.image=o.cardImage,a.push(r))}this.state.currentHands[this.state.sceneId]||(this.state.currentHands[this.state.sceneId]=[]);var s=this.state.currentHands[this.state.sceneId],c={};for(var d of s)c[d.id]=d;c=this.__filterViewable(c);for(var u=0;u<s.length;u++)for(;s[u]&&!c[s[u].id];)s.splice(u,1);this.ui.displayDecks(n),this.ui.displayHand(s,i.maxCards),this.ui.displayPinnedCards(a)}else this.state.enableTranscript&&this.transcript.push(e),this.ui.displayChoices(e);return this},y.prototype.displaySceneContent=function(e){var i=this.getCurrentScene();t(i);var n=null;i.faceImage&&(n=i.faceImage);var a=i.signal||this.game.sceneSignal;if(void 0!==a&&this.ui.signal({signal:a,event:"scene-display",id:this.state.sceneId}),e?(this.ui.newPage(),this.ui.displayContent(this.state.tempCurrentContent,n),this.state.currentContent=this.state.tempCurrentContent.slice()):i.newPage&&(this.ui.newPage(),this.state.currentContent=[]),this.ui.setStyle(i.style),this.ui.removeChoices(),void 0!==i.content&&!e){var r=this._makeDisplayContent(i.content,!0);this.state.enableTranscript&&(this.transcript=this.transcript.concat(r)),this.state.currentContent=this.state.currentContent.concat(r),this.ui.displayContent(r,n)}return this._runActions(i.onDisplay),this},y.prototype.choose=function(e){var i=this.choiceCache;if(t(i),i.length<=e)throw new Error("No choice at index "+e+", only "+i.length+" choices are available.");var n=i[e];if(!n.canChoose)throw new Error("Attempted to choose index "+e+", but that choice is unavailable.");var a=n.id;return this.state.enableTranscript&&this.transcript.push("> "+n.title),delete this.choiceCache,this.goToScene(a),this},y.prototype.chooseSceneId=function(t){return delete this.choiceCache,this.goToScene(id),this},y.prototype.drawCard=function(e){var i=this.state.sceneId,n=this.getCurrentScene();t(n);var a=this.state.currentHands[i];if(n.maxCards<=a.length)return{id:null,title:"no_space_in_hand"};var r=this._drawFromDeck(e);if(!r)return{id:null,title:"no_card_in_deck"};this.state.lastDrawnCard=r;var o=this.game.scenes[r.id].cardImage;return r.image=o,this.state.currentHands[i].push(r),this.ui.displayHand(this.state.currentHands[i],n.maxCards),r},y.prototype.playCard=function(t){for(var e=this.state.sceneId,i=this.state.currentHands[e],n=0;n<i.length;n++)if(i[n].id==t){i.splice(n,1);break}this.state.lastPlayedCard=this.game.scenes[t],delete this.choiceCache,this.goToScene(t)},y.prototype.playPinnedCard=function(t){delete this.choiceCache,this.goToScene(t)},y.prototype.goToScene=function(t){this.state.sceneIdsSinceGoTo=[],this.ui.beginOutput(),this.__changeScene(t),this.ui.endOutput()},y.prototype.beginGame=function(t){this.random=t?_.fromSeeds(t):_.fromUnique(),this.state={sceneId:null,sceneIdsSinceGoTo:[],rootSceneId:this.game.rootScene||this.game.firstScene||"root",gameOver:!1,visits:{},qualities:{},currentRandomState:null,currentContent:[],tempCurrentContent:[],prevSpecialSceneId:null,prevSceneId:null,prevTopSceneId:null,jumpSceneId:null,achievements:{},bg:null,sceneStack:[],justReturned:!1,justReturnedStart:!1,justReturnedEnd:!1,sprites:{},currentHands:{},lastDrawnCard:null,lastPlayedCard:null,enableTranscript:!1,disableSaves:!1},this.transcript=[],this._setUpQualities(),this._loadAchievements(),this.ui.beginGame();var e=this.game.firstScene||this.state.rootSceneId;return this.goToScene(e),this},y.prototype._loadAchievements=function(){if("undefined"!=typeof localStorage&&localStorage[this.game.title+"_achievements"])for(var t in this.state.achievements=JSON.parse(localStorage[this.game.title+"_achievements"]),this.state.achievements)this.state.qualities["achievement_"+t]=1},y.prototype.gameOver=function(){return this.state.gameOver=!0,this.displayGameOver(),this},y.prototype.isGameOver=function(){return this.state.gameOver},y.prototype.getCurrentScene=function(){var e=this.game.scenes[this.state.sceneId];return t(void 0!==e),e},y.prototype.getCurrentChoices=function(){return this.choiceCache},y.prototype.setState=function(t){if(this.state=t,this._setUpQualities(),this.random=_.fromState(this.state.currentRandomState),this._loadAchievements(),this.isGameOver())this.displayGameOver();else{var e=this.getCurrentScene();this.choiceCache=this._compileChoices(e),this.ui.newPage(),this.ui.removeChoices(),this.ui.displayContent(this.state.currentContent),this.displayChoices(),this.ui.setSprites(this.state.sprites),this.ui.setBg(this.state.bg)}return this},y.prototype.getExportableState=function(){return this.state},y.prototype._getQDisplay=function(e,i){switch(i){case"cardinal":case"number":return u(e);case"ordinal":return l(e);case"fudge":return h(e);default:var n=this.game.qdisplays[i];return t(void 0!==n),p(e,n)}},y.prototype._evaluateStateDependencies=function(e){for(var i=[],n=0;n<e.length;++n){var a,r=e[n],o=r.fn;if("insert"===r.type)a=this._runExpression(o),a=r.qdisplay?this._getQDisplay(a,r.qdisplay):a.toString();else t("predicate"===r.type),a=this._runPredicate(o);void 0!==a.stateDependencies&&(a=this._makeDisplayContent(a,!1)),i.push(a)}return i},y.prototype._mergeStateEvalsInArray=function(t,e){Array.isArray(t)||(t=[t]);for(var i=[],n=0;n<t.length;++n)i=i.concat(this._mergeStateEvals(t[n],e));return i},y.prototype._mergeStateEvals=function(t,e){if(void 0===t.type)return[t];var i;switch(t.type){case"conditional":i=e[t.predicate]?this._mergeStateEvalsInArray(t.content,e):[];break;case"insert":i=e[t.insert];break;default:var n={type:t.type};n.content=this._mergeStateEvalsInArray(t.content,e),i=[n]}return i},y.prototype._makeDisplayContent=function(t,e){if(void 0===t.content)return Array.isArray(t)?t:e?[{type:"paragraph",content:t}]:[t];if(void 0===t.stateDependencies&&void 0!==t.type)return[t];var i=t.stateDependencies,n=t.content;if(i&&i.length>0){var a=this._evaluateStateDependencies(i);Array.isArray(n)||(n=[n]),n=this._mergeStateEvalsInArray(n,a)}return n},y.prototype._setUpQualities=function(){var t=this._qualitiesAccessorsPrivate={},e=this.state.qualities,i=this;n(this.game.qualities,(function(n,a){var r=a.min,o=a.max,s=a.signal||i.game.qualitySignal,c=a.isValid;(void 0!==r||void 0!==o||void 0!==s||void 0!==c)&&(void 0!==e[n]&&(t[n]=e[n]),e.__defineGetter__(n,(function(){return t[n]})),e.__defineSetter__(n,(function(e){void 0!==r&&e<r&&(e=r),void 0!==o&&e>o&&(e=o);var a=t[n];if(t[n]=e,i._runPredicate(c,!0)||(t[n]=e=a),void 0!==s&&e!==a){var d={signal:s,event:"quality-change",id:n,now:e};void 0!==a&&(d.was=a),i.ui.signal(d)}}))),void 0!==a.initial&&void 0===e[n]&&(e[n]=a.initial)}))},y.prototype._runActions=function(t){o(t,this,this.state)},y.prototype._runPredicate=function(t,e){return s(t,e,this,this.state)},y.prototype._runExpression=function(t,e){return c(t,e,this,this.state)},y.prototype.__changeScene=function(e){this.state.justReturned&&(this.state.justReturned=!1);var i=null,n=!1;"prevScene"==e?(this.prevSceneId,i=this.game.scenes[this.state.prevSceneId],e=this.state.prevSceneId,t(i)):"prevTopScene"==e?(i=this.game.scenes[this.state.prevTopSceneId],e=this.state.prevTopSceneId,t(i)):"jumpScene"==e?(i=this.game.scenes[this.state.jumpSceneId],e=this.state.jumpSceneId,t(i)):"backSpecialScene"===e?(i=this.game.scenes[this.state.prevSpecialSceneId],e=this.state.prevSpecialSceneId,n=!0,t(i),this.state.prevSpecialSceneId=null):(i=this.game.scenes[e],t(i));var a=this.state.sceneId,r=this.game.scenes[a];if(a){this.state.prevSceneId=a,r.newPage&&(this.state.prevTopSceneId=a),i.isSpecial&&null===this.state.prevSpecialSceneId&&(this.state.tempCurrentContent=this.state.currentContent.slice(),this.state.prevSpecialSceneId=a);var o=this.getCurrentScene();this._runActions(o.onDeparture);var s=o.signal||this.game.sceneSignal;void 0!==s&&this.ui.signal({signal:s,event:"scene-departure",id:this.state.sceneId,to:e})}if(this.state.sceneId=e,this.state.sceneIdsSinceGoTo.push(e),i.setRoot&&(this.state.rootSceneId=e),i.setJump&&(this.state.jumpSceneId=i.setJump),void 0!==i.countVisitsMax&&(void 0===this.state.visits[e]?this.state.visits[e]=1:this.state.visits[e]<i.countVisitsMax&&this.state.visits[e]++),!n&&!this.state.justReturned&&(this._runActions(i.onArrival),i.call)){var c=this.game.scenes[i.call];this._runActions(c.onArrival)}var d=i.signal||this.game.sceneSignal;if(void 0!==d){var u={signal:d,event:"scene-arrival",id:e};a&&(u.from=a),this.ui.signal(u)}this.state.currentRandomState=this.random.getState(),this.displaySceneContent(n),i.setBg&&(this.state.bg=i.setBg,this.ui.setBg(i.setBg)),i.setSprites&&(this.state.sprites=i.setSprites,this.ui.setSprites(i.setSprites)),i.audio&&this.ui.audio(i.audio),i.setTopLeftStyle&&this.ui.setSpriteStyle("topLeft",i.setTopLeftStyle),i.setTopRightStyle&&this.ui.setSpriteStyle("topRight",i.setTopRightStyle),i.setBottomLeftStyle&&this.ui.setSpriteStyle("bottomLeft",i.setBottomLeftStyle),i.setBottomRightStyle&&this.ui.setSpriteStyle("bottomRight",i.setBottomRightStyle),i.achievement&&this.achieve(i.achievement);var l=!1;if(!0===i.gameOver)l=!0,this.gameOver();else if(i.goSubEnd&&!this.state.justReturnedEnd)for(var h=[],p=0;p<i.goSub.length;++p){var m=i.goSub[p];(void 0===m.predicate||this._runPredicate(m.predicate))&&h.push(m.id)}else if(i.goTo){for(var v=[],y=0;y<i.goTo.length;++y){var _=i.goTo[y];(void 0===_.predicate||this._runPredicate(_.predicate))&&v.push(_.id)}if(1===v.length)l=!0,this.__changeScene(v[0]);else if(v.length>1){var S=v[this.random.uint32()%v.length];l=!0,this.__changeScene(S)}}else if(i.goToRef){for(var b=[],w=0;w<i.goToRef.length;++w){var C=i.goToRef[w];(void 0===C.predicate||this._runPredicate(C.predicate))&&b.push(C.id)}if(1===b.length)l=!0,this.__changeScene(this.state.qualities[b[0]]);else if(b.length>1){var k=b[this.random.uint32()%b.length];l=!0,this.__changeScene(this.state.qualities[k])}}var x,I,D,P=!1;if(i.checkQuality&&i.broadDifficulty&&i.checkSuccessGoTo&&i.checkFailureGoTo){var q=.6;i.difficultyScaler&&(q=i.difficultyScaler),x=g(this.state.qualities[i.checkQuality]||0,i.broadDifficulty,q),P=!0}else if(i.checkQuality&&i.narrowDifficulty&&i.checkSuccessGoTo&&i.checkFailureGoTo){var E=.1;i.difficultyIncrement&&(E=i.difficultyIncrement),x=f(this.state.qualities[i.checkQuality]||0,i.narrowDifficulty,E),P=!0}P&&(I=x,l=!0,((D=this.random)?D.random():Math.random())<I?this.__changeScene(i.checkSuccessGoTo):this.__changeScene(i.checkFailureGoTo)),l||(this.choiceCache=this._compileChoices(i),null===this.choiceCache?!1!==i.gameOver&&this.gameOver():this.displayChoices())},y.prototype.achieve=function(t){this.state.achievements[t]=1,this.state.qualities["achievement_"+t]=1,this.state.qualities["game_achievement_"+t]=1,"undefined"!=typeof localStorage&&(localStorage[this.game.title+"_achievements"]=JSON.stringify(this.state.achievements))},y.prototype.__getChoiceSelectionData=function(t){var e=[];for(var i in t){var n=this.game.scenes[i],a=t[i];a.order=a.order||n.order||0,a.priority=a.priority||n.priority||1,void 0===a.frequency&&(a.frequency=n.frequency,void 0===a.frequency&&(a.frequency=100)),n.frequencyVar&&(a.frequency=this.runExpression(n.frequencyVar)),a.selectionPriority=0,e.push(a)}return e},y.prototype.__filterViewable=function(t){var e={};for(var i in t){var n=this.game.scenes[i],a=n.maxVisits;if(void 0!==a)if((this.state.visits[i]||0)>=a)continue;if(void 0!==n.maxVisitsVar)if(a=this._runExpression(n.maxVisitsVar),(this.state.visits[i]||0)>=a)continue;this._runPredicate(n.viewIf,!0)&&(e[i]=t[i])}return e},y.prototype.__getChoiceIdsFromOptions=function(e){var r=this,o={};return i(e,(function(e){if(r._runPredicate(e.viewIf,!0))if("@"===e.id.substr(0,1)){var i=e.id.substring(1),s=a(e,{id:i});o[i]=s}else{t("#"===e.id.substr(0,1));var c=r.game.tagLookup[e.id.substring(1)];n(c,(function(t){void 0===o[t]&&(o[t]=a(e,{id:t}))}))}})),o},y.prototype.__filterByPriority=function(e,n,a){t(null===n||null===a||a>=n);var r,o,s=this,c=[],d=[];e.sort((function(t,e){return e.priority-t.priority}));for(var u=0;u<e.length;++u){if((r=e[u]).priority!==o){if(void 0!==o&&(null===n||u>=n))break;c.push.apply(c,d),d=[],o=r.priority}d.push(r)}var l=c.length,h=l+d.length;if(null===a||a>=h)c.push.apply(c,d);else{i(d,(function(t){null===t.frequency?t.selectionPriority=0:t.selectionPriority=s.random.random()/t.frequency})),d.sort((function(t,e){return t.selectionPriority-e.selectionPriority}));var p=a-l,g=d.slice(0,p);c.push.apply(c,g)}return c},y.prototype.__getChoiceDisplayData=function(e){for(var i=[],n=0,a=0;a<e.length;++a){var r=e[a],o=this.game.scenes[r.id],s=!0;r.chooseIf&&(s=this._runPredicate(r.chooseIf,!0)),s&&o.chooseIf&&(s=this._runPredicate(o.chooseIf,!0));var c=r.title||o.title;t(c);var d=null;s||(d=r.unavailableSubtitle||o.unavailableSubtitle),d||(d=r.subtitle||o.subtitle);var u,l={id:r.id,canChoose:s,title:this._makeDisplayContent(c,!1)};if(d&&(l.subtitle=this._makeDisplayContent(d,!1)),o.checkQuality&&o.broadDifficulty&&o.checkSuccessGoTo&&o.checkFailureGoTo){var h=.6;o.difficultyScaler&&(h=o.difficultyScaler),u=g(this.state.qualities[o.checkQuality]||0,o.broadDifficulty,h),l.checkQuality=o.checkQuality,l.successProb=u,l.difficulty=m(u)}else if(o.checkQuality&&o.narrowDifficulty&&o.checkSuccessGoTo&&o.checkFailureGoTo){var p=.1;o.difficultyIncrement&&(p=o.difficultyIncrement),u=f(this.state.qualities[o.checkQuality]||0,o.narrowDifficulty,p),l.checkQuality=o.checkQuality,l.successProb=u,l.difficulty=m(u)}i.push(l),s&&++n}return{choices:i,numChoosable:n}},y.prototype._compileChoices=function(e){t(e);var i=e.options,n=[],a=0;if(void 0!==i){var r=this.__getChoiceIdsFromOptions(i);r=this.__filterViewable(r);var o=this.__getChoiceSelectionData(r),s=e.minChoices||null,c=e.maxChoices||null;(o=this.__filterByPriority(o,s,c)).sort((function(t,e){return t.order-e.order}));var d=this.__getChoiceDisplayData(o);n=d.choices,a=d.numChoosable}if(0===a){var u=this.state.rootSceneId;if(u!==this.state.sceneId){var l=this.game.scenes[u].chooseIf;l&&!this._runPredicate(l,!0)||(n.push({id:u,title:"Continue...",canChoose:!0}),++a)}}return a>0?n:null},y.prototype._drawFromDeck=function(t){var e=this.game.scenes[t],i=this._compileChoices(e);if(!i)return null;var n=[],a=this.state.currentHands[this.state.sceneId];for(var r of(a||(a=[]),a=a.map((t=>t.id)),i)){var o=this.game.scenes[r.id];r.canChoose&&o.isCard&&a.indexOf(r.id)<0&&n.push(r)}return n?n[this.random.uint32()%n.length]:null};var _=function(t,e,i,n,a){this.getState=function(){return[t,e,i,n,a]};this.uint32=function(){var r,o,s,c,d=(i^i>>>7)>>>0;return i=n,n=a,a=e,e=t,((((r=n+n+1)>>16&65535)*(c=65535&(o=t=t^t<<6^(d^d<<13)>>>0))+(s=65535&r)*(o>>16&65535)&65535)<<16>>>0)+s*c>>>0},this.random=function(){return 2.3283064365386963e-10*this.uint32()}},S=1;_.fromUnique=function(){var t=(new Date).getTime();return _.fromSeeds([t,S++])},_.fromTime=function(){return _.fromSeeds([(new Date).getTime()])},_.fromSeeds=function(t){for(var e=886756453,i=88675123,n=123456789,a=362436069,r=521288629,o=function(t){t=t.toString();for(var e=4022871197,i=0;i<t.length;i++){var n=.02519603282416938*(e+=t.charCodeAt(i));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)},s=0;s<t.length;s++){var c=4294967296*o(t[s]);e^=c,i^=c,n^=c,a^=c,r^=c}return new _(e,i,n,a,r)},_.fromState=function(t){return new _(t[0],t[1],t[2],t[3],t[4])},e.exports={makeFunctionFromSource:r,runActions:o,runPredicate:s,runExpression:c,convertJSONToGame:function(t,e){try{return e(null,JSON.parse(t,(function(t,e){return function(t){var e=typeof t;return"function"===e||t&&"object"===e||!1}(e)&&void 0!==e.$code?r(e.$code):e})))}catch(t){return e(t)}},simpleContent:d,getCardinalNumber:u,getOrdinalNumber:l,getUserQDisplay:p,getFudgeDisplay:h,DendryEngine:y,UserInterface:v,NullUserInterface:v,Random:_}}()},{}],2:[function(t,e,i){!function(e){"use strict";var i=t("./content/html"),n=t("../engine"),a=function(t,e){this.game=t,this.$content=e,this._registerEvents(),this.dendryEngine=new n.DendryEngine(this,t),this.base_settings={disable_bg:!1,animate:!1,animate_bg:!0,disable_audio:!1,show_portraits:!0,dark_mode:!1},this.current_settings={disable_bg:!1,animate:!1,animate_bg:!0,disable_audio:!1,show_portraits:!0,dark_mode:!1},this.disable_bg=!1,this.animate=!1,this.animate_bg=!0,this.disable_audio=!1,this.show_portraits=!0,this.fade_time=600,this.bg_fade_out_time=200,this.bg_fade_in_time=1e3,this.sound_fade_time=2e3,this.contentToHTML=i,this.spriteLocs={topLeft:1,topRight:1,bottomLeft:1,bottomRight:1},this.currentAudio=null,this.currentAudioURL="",this.audioQueue=[],this.audioPlaylist=[],this.onNewPage=!1,this.save_prefix=t.title+"_"+t.author+"_save",this.max_slots=8,this.DateOptions={hour:"numeric",minute:"numeric",second:"numeric",year:"numeric",month:"short",day:"numeric"}};n.UserInterface.makeParentOf(a),a.prototype.loadGame=function(t){var e=this;t.endsWith(".json")||(t.endsWith("/")?t+="game.json":t+="/game.json"),fetch(t).then((t=>t.text())).then((t=>{game=n.convertJSONToGame(t,(function(t,e){if(t)throw t;return e})),e.game=game,e.dendryEngine=new n.DendryEngine(e,game),e.dendryEngine.beginGame()})).catch((t=>console.log(t)))},a.prototype.displayContent=function(t,n){var a=e(i.convert(t));if(n&&this.show_portraits){!0,console.log(n);var r=document.createElement("div");r.className="face-figure";var o=new Image;o.className="face-img",r.appendChild(o),a.splice(1,0,r),o.src=n}this.animate?(a.fadeIn(this.fade_time),this.$content.append(a)):this.$content.append(a),a.focus(),window&&window.onDisplayContent&&window.onDisplayContent()},a.prototype.displayGameOver=function(){var t=e("<p>").text(this.getGameOverMsg()).addClass("game-over");this.animate?(t.fadeIn(this.fade_time),this.$content.append(t)):this.$content.append(t),t.focus()},a.prototype.displayChoices=function(t){for(var n=e("<ul>").addClass("choices"),a=0;a<t.length;++a){var r=t[a],o=i.convertLine(r.title),s="";void 0!==r.subtitle&&(s=i.convertLine(r.subtitle));var c=e("<li>"),d=c;r.canChoose?(d=e("<a>").attr({href:"#","data-choice":a}),c.html(d)):d.addClass("unavailable"),d.html(o),r.checkQuality&&r.difficulty&&void 0!==r.successProb&&(s&&(s+="<br>"),s+="Check: "+r.checkQuality+"<br>",s+="Difficulty: "+r.difficulty+" ("+Math.floor(100*r.successProb)+"%)"),s&&c.append(e("<div>").addClass("subtitle").html(s)),n.append(c)}this.animate?(n.fadeIn(this.fade_time),this.$content.append(n)):this.$content.append(n),n.focus(),this.onNewPage&&(this.onNewPage=!1,window&&window.onNewPage&&window.onNewPage())},a.prototype.newPage=function(){if(this.animate){this.$content;this.$content.empty(),this.$content.children().fadeOut(this.fade_time,(function(){}))}else this.$content.empty();this.onNewPage=!0},a.prototype.setStyle=function(t){this.$content.removeClass(),void 0!==t&&this.$content.addClass(t)},a.prototype.removeChoices=function(){e(".choices",this.$content).remove(),e(".hidden",this.$content).remove()},a.prototype.beginOutput=function(){e("#read-marker",this.$content).remove(),this.$content.append(e("<hr>").attr("id","read-marker"))},a.prototype.endOutput=function(){var t=e("#read-marker");this.animate&&(t.length>0?e("html, body").animate({scrollTop:t.offset().top},this.fade_time):e("html, body").animate({scrollTop:0},this.fade_time))},a.prototype.signal=function(t){console.log(t);var e=t.signal,i=t.event,n=t.id;window&&window.handleSignal&&window.handleSignal(e,i,n)},a.prototype.displayHand=function(t,i){if(window&&window.displayHand)return window.displayHand(t,i),null;var n="Hand - click a card to play.";window.handDescription&&(n=window.handDescription),this.dendryEngine.state.qualities.handDescription&&(n=this.dendryEngine.state.qualities.handDescription);var a=e(".hand"),r=!1;0==a.length?(a=e("<ul>").addClass("hand"),this.$content.append(e("<hr>")),this.$content.append(e("<p>").addClass("hand-description").text(n))):(a.empty(),r=!0);for(var o=0;o<i;o++){var s=e("<li>").addClass("card-in-hand");if(t[o]){var c=t[o],d=e("<a>").addClass("card").attr({href:"#","card-id":c.id,title:c.title}),u=e("<span>").addClass("card-caption").text(c.title);if(c.image){var l=e("<img>").addClass("card-img").attr({src:c.image});d.append(l)}if(c.subtitle){var h=e("<span>").addClass("card-tooltip").text(c.subtitle);d.append(h)}s.append(d),s.append(u),a.append(s)}else{var p=e("<div>").addClass("blank-card");s.append(p)}a.append(s)}r||this.$content.append(a)},a.prototype.displayDecks=function(t){if(window&&window.displayDecks)return window.displayDecks(t),null;var i="Decks - click a deck to draw a card.";window.deckDescription&&(i=window.deckDescription),this.dendryEngine.state.qualities.deckDescription&&(i=this.dendryEngine.state.qualities.deckDescription),this.$content.append(e("<hr>")),this.$content.append(e("<p>").addClass("deck-description").text(i));var n=e("<ul>").addClass("decks");for(var a of t){var r=e("<li>").addClass("deck"),o=e("<a>").addClass("card").attr({href:"#","card-id":a.id,title:a.title}),s=e("<span>").addClass("card-caption").text(a.title);if(a.image){var c=e("<img>").addClass("card-img").attr({src:a.image});o.append(c)}if(a.subtitle){var d=e("<span>").addClass("card-tooltip").text(a.subtitle);o.append(d)}a.canChoose||(r=r.addClass("unavailable-card")),r.append(o),r.append(s),n.append(r)}this.$content.append(n)},a.prototype.displayPinnedCards=function(t){if(0==t.length)return null;if(window&&window.displayPinnedCards)return window.displayPinnedCards(t),null;var i="Pinned cards - click a card to play.";window.pinnedCardsDescription&&(i=window.pinnedCardsDescription),this.dendryEngine.state.qualities.pinnedCardsDescription&&(i=this.dendryEngine.state.qualities.pinnedCardsDescription),this.$content.append(e("<hr>")),this.$content.append(e("<p>").addClass("pinned-text-description").text(i));var n=e("<ul>").addClass("pinned-cards");for(var a of t){var r=e("<li>").addClass("pinned-card"),o=e("<a>").addClass("card").attr({href:"#","card-id":a.id,title:a.title}),s=e("<span>").addClass("card-caption").text(a.title);if(a.image){var c=e("<img>").addClass("card-img").attr({src:a.image});o.append(c)}if(a.subtitle){var d=e("<span>").addClass("card-tooltip").text(a.subtitle);o.append(d)}r.append(o),r.append(s),n.append(r)}this.$content.append(n)},a.prototype.setBg=function(t){this.disable_bg?(e("#bg1").addClass("content_hidden"),e("#bg1").removeClass("content_visible"),e("#bg1").css("background-image","none")):t&&"none"!=t&&"null"!=t?t.startsWith("#")||t.startsWith("rgba(")||t.startsWith("rgb(")?this.animate_bg?(e("#bg1").fadeOut(this.bg_fade_out_time,(function(){e("#bg1").css("background-image","none"),e("#bg1").css("background-color",t)})),e("#bg1").fadeIn(this.bg_fade_in_time,(function(){e("#bg2").css("background-image","none")})),console.log("changing background color "+t)):(e("#bg1").css("background-image","none"),e("#bg1").css("bacground-color",t)):t.startsWith("linear-gradient(")?this.animate_bg?(e("#bg1").fadeOut(this.bg_fade_out_time,(function(){e("#bg1").css("background-image",t)})),e("#bg1").fadeIn(this.bg_fade_in_time,(function(){e("#bg2").css("background-image",t)})),console.log("changing background gradient "+t)):e("#bg1").css("background-image",t):this.animate_bg?(e("#bg1").fadeOut(this.bg_fade_out_time,(function(){e("#bg1").css("background-image",'url("'+t+'")')})),e("#bg1").fadeIn(this.bg_fade_in_time,(function(){e("#bg2").css("background-image",e("#bg1").css("background-image"))}))):e("#bg1").css("background-image",'url("'+t+'")'):this.animate_bg?(e("#bg1").addClass("content_hidden"),e("#bg1").removeClass("content_visible"),setTimeout((function(){e("#bg1").css("background-image","none"),e("#bg1").removeClass("content_hidden"),e("#bg1").addClass("content_visible")}),100)):e("#bg1").css("background-image","none")},a.prototype.setSprites=function(t){if(window&&window.setSprites)window.setSprites(t);else{if(!this.show_portraits||"none"==t||"clear"==t)return e("#topLeftSprite").children().fadeOut(this.fade_time,(function(){e("#topLeftSprite").empty()})),e("#topRightSprite").children().fadeOut(this.fade_time,(function(){e("#topRightSprite").empty()})),e("#bottomLeftSprite").children().fadeOut(this.fade_time,(function(){e("#bottomLeftSprite").empty()})),void e("#bottomRightSprite").children().fadeOut(this.fade_time,(function(){e("#bottomRightSprite").empty()}));if(t instanceof Array)for(var i=0;i<t.length;i++){var n=t[i][0],a=t[i][1];this.setSprite(n,a)}else if(t)for(var r in Object.keys(t))sprites.push([r,t[r]])}},a.prototype.setSprite=function(t,i){if(this.show_portraits)if(window&&window.setSprite)window.setSprite(t,i);else{var n;if("topleft"==(t=t.toLowerCase())?n=e("#topLeftSprite"):"topright"==t?n=e("#topRightSprite"):"bottomleft"==t?n=e("#bottomLeftSprite"):"bottomright"==t&&(n=e("#bottomRightSprite")),"none"==i||"clear"==i)return delete this.dendryEngine.state.sprites[t],void n.fadeOut(this.fade_time,(function(){n.empty()}));this.dendryEngine.state.sprites[t]=i,n.fadeOut(this.fade_time,(function(){n.emtpy();var t=new Image;t.src=i,n.append(t),console.log("fadeIn"),n.fadeIn(this.fade_time)}))}},a.prototype.setSpriteStyle=function(t,i){if(window&&window.setSpriteStyle)window.setSpriteStyle(t,i);else{var n;if("topleft"==t)n=e("#topLeftSprite");else if("topright"==t)n=e("#topRightSprite");else if("bottomleft"==t)n=e("#bottomLeftSprite");else{if("bottomright"!=t)return;n=e("#bottomRightSprite")}n.css(i)}},a.prototype.audio=function(t){if(this.disable_audio)this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.loop=!1);else{var i=t.split(" "),n=[],a=!1,r=!1,o=!1,s=!1,c=!1;for(var d of i)"loop"==d?a=!0:"queue"==d?r=!0:"nofade"==d?o=!0:"shuffle"==d?s=!0:"clear"==d?c=!0:n.push(d);c&&(this.audioPlaylist=[]),(n.length>=1||s)&&(this.audioPlaylist=this.audioPlaylist.concat(n));var u=n[0],l=this.currentAudio,h=this.sound_fade_time,p=this.audioPlaylist;if("null"==u||"none"==u)this.currentAudio&&(e(l).animate({volume:0},this.sound_fade_time,(function(){l.pause()})),this.currentAudio.loop=!1);else{if(console.log("new audio:",u,"current audio:",this.currentAudioURL),this.currentAudio&&(this.currentAudioURL==u||r||s))if(l.ended||l.paused)this.currentAudioURL=u,l.src=u,console.log("Fading in new audio"),l.volume=0,l.play(),e(l).animate({volume:1},h),this.currentAudio.onended=function(){var t;if(r)t=g.pop(),console.log("playing from queue");else if(s){var i=Math.floor(Math.random()*p.length);t=p[i],console.log("playing from playlist")}t&&(l.src=t,console.log("Now playing",t),l.play(),e(l).animate({volume:1},h),window.dendryUI.currentAudioURL=t)};else{console.log("adding music to queue"),this.audioQueue.push(u);var g=this.audioQueue;this.currentAudio.onended=function(){var t;if(r)t=g.pop(),console.log("playing from queue");else if(s){var i=Math.floor(Math.random()*p.length);t=p[i],console.log("playing from playlist")}t&&(l.src=t,console.log("Now playing",t),l.play(),e(l).animate({volume:1},h),window.dendryUI.currentAudioURL=t)}}else this.currentAudio?(this.currentAudioURL=u,console.log("currentAudio present,  fading out current audio"),l.onended=function(){},o?(l.pause(),l.src=u,l.play()):e(l).animate({volume:0},this.sound_fade_time,(function(){console.log(l),l.src=u,console.log("Fading in new audio"),l.play(),e(l).animate({volume:1},h)}))):this.currentAudio||(this.currentAudio=new Audio(u),this.currentAudio.volume=0,this.currentAudio.play(),e(this.currentAudio).animate({volume:1},this.sound_fade_time),l=this.currentAudio,s&&(this.currentAudio.onended=function(){var t=Math.floor(Math.random()*p.length),i=p[t];i&&(l.src=i,console.log("playing from shuffle"),console.log("Now playing",i),l.play(),e(l).animate({volume:1},h),window.dendryUI.currentAudioURL=i)}));this.currentAudio.loop=!!a}}},a.prototype.saveSettings=function(){"undefined"!=typeof localStorage&&(localStorage[this.game.title+"_animate"]=this.animate,localStorage[this.game.title+"_disable_bg"]=this.disable_bg,localStorage[this.game.title+"_animate_bg"]=this.animate_bg,localStorage[this.game.title+"_show_portraits"]=this.show_portraits,localStorage[this.game.title+"_disable_audio"]=this.disable_audio,localStorage[this.game.title+"_dark_mode"]=this.dark_mode)},a.prototype.loadSettings=function(t){var e={animate:!1,disable_bg:!1,animate_bg:!0,show_portraits:!0,disable_audio:!1,dark_mode:!1};if("undefined"!=typeof localStorage)for(var i in e)if(e.hasOwnProperty(i)){var n=this.game.title+"_"+i;n in localStorage?this[i]="false"!=localStorage[n]:t&&t.hasOwnProperty(i)?this[i]=t[i]:this[i]=e[i]}},a.prototype.toggle_audio=function(t){t?(this.disable_audio=!1,this.currentAudio&&this.currentAudio.play()):(this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.loop=!1),this.disable_audio=!0)},a.prototype.autosave=function(){var t=localStorage[this.save_prefix+"_a0"];t&&(localStorage[this.save_prefix+"_a1"]=t,localStorage[this.save_prefix+"_timestamp_a1"]=localStorage[this.save_prefix+"_timestamp_a0"]);var e="a0",i=JSON.stringify(this.dendryEngine.getExportableState());localStorage[this.save_prefix+"_"+e]=i;var n=this.dendryEngine.state.sceneId,a=new Date(Date.now());a=n+"\n("+a.toLocaleString(void 0,this.DateOptions)+")",localStorage[this.save_prefix+"_timestamp_"+e]=a,this.populateSaveSlots(e+1,2)},a.prototype.quickSave=function(){var t=JSON.stringify(this.dendryEngine.getExportableState());localStorage[this.save_prefix+"_q"]=t,window.alert("Saved.")},a.prototype.saveSlot=function(t){var e=JSON.stringify(this.dendryEngine.getExportableState());localStorage[this.save_prefix+"_"+t]=e;var i=this.dendryEngine.state.sceneId,n=new Date(Date.now());n=i+"\n("+n.toLocaleString(void 0,this.DateOptions)+")",localStorage[this.save_prefix+"_timestamp_"+t]=n,this.populateSaveSlots(t+1,2)},a.prototype.quickLoad=function(){if(localStorage[this.save_prefix+"_q"]){var t=localStorage[this.save_prefix+"_q"];this.dendryEngine.setState(JSON.parse(t)),window.alert("Loaded.")}else window.alert("No save available.")},a.prototype.loadSlot=function(t){if(localStorage[this.save_prefix+"_"+t]){var e=localStorage[this.save_prefix+"_"+t];this.dendryEngine.setState(JSON.parse(e)),this.hideSaveSlots(),window.alert("Loaded.")}else window.alert("No save available.")},a.prototype.deleteSlot=function(t){localStorage[this.save_prefix+"_"+t]?(localStorage[this.save_prefix+"_"+t]="",localStorage[this.save_prefix+"_timestamp_"+t]="",this.populateSaveSlots(t+1,2)):window.alert("No save available.")},a.prototype.exportSlot=function(t){if(localStorage[this.save_prefix+"_"+t]){var e=localStorage[this.save_prefix+"_"+t],i=document.createElement("a"),n=new Blob([e],{type:"text/plain"});i.href=URL.createObjectURL(n),i.download="save.txt",i.click()}else window.alert("No save available.")},a.prototype.importSave=function(t){var e=this;var i=document.getElementById(t),n=new FileReader,a=i.files[0];console.log(i.files),n.onload=function(t){var i=t.target.result;e.dendryEngine.setState(JSON.parse(i)),e.hideSaveSlots(),window.alert("Loaded.")},n.readAsText(a)},a.prototype.populateSaveSlots=function(t,e){var i=this;function n(t){var e=document.getElementById("save_info_"+t),n=document.getElementById("save_button_"+t),a=document.getElementById("delete_button_"+t);if(localStorage[i.save_prefix+"_"+t]){var r=localStorage[i.save_prefix+"_timestamp_"+t];e.textContent=r,n.textContent="Load",n.onclick=function(t){return function(e){i.loadSlot(t)}}(t),a.onclick=function(t){return function(e){i.deleteSlot(t)}}(t)}else n.textContent="Save",e.textContent="Empty",n.onclick=function(t){return function(e){i.saveSlot(t)}}(t);try{var o=document.getElementById("export_button_"+t);localStorage[i.save_prefix+"_"+t]&&(o.onclick=function(t){return function(e){i.exportSlot(t)}}(t))}catch(t){}}for(var a=0;a<t;a++)n(a);for(a=0;a<e;a++)n("a"+a)},a.prototype.showSaveSlots=function(){if(this.dendryEngine.state.disableSaves)window.alert("Saving and loading is currently disabled.");else{var t=document.getElementById("save");t.style.display="block",this.populateSaveSlots(this.max_slots,2);var e=this;t.onclick||(t.onclick=function(t){t.target==document.getElementById("save")&&e.hideSaveSlots()})}},a.prototype.hideSaveSlots=function(){document.getElementById("save").style.display="none"},a.prototype.setOption=function(t,e){this[t]=e,this.saveSettings()},a.prototype.populateOptions=function(){var t=this.disable_bg,i=this.animate,n=this.animate_bg;t?e("#backgrounds_no")[0].checked=!0:e("#backgrounds_yes")[0].checked=!0,i?e("#animate_yes")[0].checked=!0:e("#animate_no")[0].checked=!0,n?e("#animate_bg_yes")[0].checked=!0:e("#animate_bg_no")[0].checked=!0},a.prototype.showOptions=function(){var t=document.getElementById("options");this.populateOptions(),t.style.display="block",t.onclick||(t.onclick=function(t){t.target==document.getElementById("options")&&this.hideOptions()})},a.prototype.getGameOverMsg=function(){return"Game Over (reload to read again)"},a.prototype._registerEvents=function(){var t=this;this.$content.on("click","ul.choices li a",(function(i){i.preventDefault(),i.stopPropagation();var n=parseInt(e(this).attr("data-choice"));return t.dendryEngine.choose(n),!1})),this.$content.on("click","ul.choices li",(function(t){return t.preventDefault(),t.stopPropagation(),e("a",this).click(),!1})),this.$content.on("click","ul.decks li a",(function(i){i.preventDefault(),i.stopPropagation();var n=e(this).attr("card-id");return t.dendryEngine.drawCard(n),!1})),this.$content.on("click","ul.hand li a",(function(i){i.preventDefault(),i.stopPropagation();var n=e(this).attr("card-id");return t.dendryEngine.playCard(n),!1})),this.$content.on("click","ul.pinned-cards li a",(function(i){i.preventDefault(),i.stopPropagation();var n=e(this).attr("card-id");return t.dendryEngine.playPinnedCard(n),!1}))};e((function(){n.convertJSONToGame(window.game.compiled,(function(t,i){if(t)throw t;var n=new a(i,e("#content"));if((window.dendryUI=n,void 0!==window.dendryModifyUI)&&window.dendryModifyUI(n))return;n.dendryEngine.beginGame()}))}))}(jQuery)},{"../engine":1,"./content/html":3}],3:[function(t,e,i){!function(){"use strict";var t=function(t){if(void 0===t.type)return"undefined"!=typeof window&&window.displayText&&(t=window.displayText(t)),t;switch(t.type){case"emphasis-1":return"<em>"+i(t.content)+"</em>";case"emphasis-2":return"<strong>"+i(t.content)+"</strong>";case"emphasis-3":return"<code>"+i(t.content)+"</code>";case"hidden":return'<span class="hidden">'+i(t.content)+"</span>";case"line-break":return"<br>";case"magic":return t.content;case"insert":case"conditional":throw new Error(t.type+" should have been evaluated by now.")}},i=function(e){if(Array.isArray(e)){for(var i=[],n=0;n<e.length;++n){var a=e[n];i.push(t(a))}return i.join("")}return t(e)};e.exports={convert:function(t){for(var e=[],n=0;n<t.length;++n){var a=t[n];switch(a.type){case"heading":e.push("<h1>"),e.push(i(a.content)),e.push("</h1>");break;case"paragraph":e.push("<p>"),e.push(i(a.content)),e.push("</p>");break;case"quotation":e.push("<blockquote>"),e.push(i(a.content)),e.push("</blockquote>");break;case"attribution":e.push('<blockquote class="attribution">'),e.push(i(a.content)),e.push("</blockquote>");break;case"magic":e.push(a.content);break;case"hrule":e.push("<hr>")}}return e.join("")},convertLine:i}}()},{}]},{},[2]);